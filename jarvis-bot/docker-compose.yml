# JARVIS — Docker Compose
# Usage:
#   docker compose up -d          # Start Jarvis (detached)
#   docker compose logs -f        # Watch logs
#   docker compose down           # Stop Jarvis
#   docker compose up -d --build  # Rebuild and restart

services:
  jarvis-bot:
    build: .
    container_name: jarvis-bot
    restart: unless-stopped
    environment:
      - TELEGRAM_BOT_TOKEN=${TELEGRAM_BOT_TOKEN}
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY}
      - GITHUB_TOKEN=${GITHUB_TOKEN}
      - TELEGRAM_OWNER_ID=8366932263
      - DOCKER=1
      - NODE_ENV=production
      - VIBESWAP_REPO=/repo
      - MEMORY_DIR=/repo/.claude/projects/C--Users-Will/memory
      - DATA_DIR=/app/data
      - OWNER_USER_ID=8366932263
      - GITHUB_REPO_URL=${GITHUB_REPO_URL:-https://github.com/WGlynn/vibeswap-private.git}
      - GITHUB_STEALTH_URL=${GITHUB_STEALTH_URL:-}
      - CLAUDE_MODEL=${CLAUDE_MODEL:-claude-sonnet-4-5-20250929}
      - COMMUNITY_GROUP_ID=${COMMUNITY_GROUP_ID:-}
      - ARK_GROUP_ID=${ARK_GROUP_ID:-}
      - AUTHORIZED_USERS=${AUTHORIZED_USERS:-}
      - BOT_USERNAME=${BOT_USERNAME:-JarvisMind1828383bot}
    volumes:
      # Persistent data — survives container rebuilds
      - ./data:/app/data
      # Persistent repo clone — avoids re-clone on restart
      - jarvis-repo:/repo
    logging:
      driver: json-file
      options:
        max-size: "10m"
        max-file: "3"

volumes:
  jarvis-repo:
    name: jarvis-repo
